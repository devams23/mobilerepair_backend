<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Location Registration & Sender</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #stopBtn { display: none; margin-top: 1em; }
    #status { margin-top: 1em; }
  </style>
</head>
<body>
  <h2>Register</h2>
  <form id="registerForm">
    <label>
      Name:
      <input type="text" id="name" required>
    </label>
    <br><br>
    <label>
      Email:
      <input type="email" id="email" required>
    </label>
    <br><br>
    <button type="submit" id="registerBtn">Register</button>
  </form>

  <button id="stopBtn">Stop Location</button>
  <div id="status"></div>

  <script>
    const apiUrl = 'http://localhost:3000/drivers/updatelocation';
    let locationInterval = null;
    let userData = {};

    const form = document.getElementById('registerForm');
    const stopBtn = document.getElementById('stopBtn');
    const status = document.getElementById('status');

    // Handle registration
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      userData = {
        driverId: email+"1234", // Unique ID for the driver
        name: document.getElementById('name').value,
        email: document.getElementById('email').value
      };

      form.style.display = 'none';
      stopBtn.style.display = 'inline-block';
      status.textContent = 'Registration successful. Sending location...';

      startSendingLocation();
    });

    // Start sending location every 10 seconds
    function startSendingLocation() {
      sendLocation(); // Send immediately
      locationInterval = setInterval(sendLocation, 10000);
    }

    // Stop sending location
    stopBtn.addEventListener('click', function() {
      clearInterval(locationInterval);
      status.textContent = 'Location sending stopped.';
      stopBtn.style.display = 'none';
      form.style.display = 'block';
    });

    // Send location to API
    function sendLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const data = {
              ...userData,
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              timestamp: position.timestamp
            };
            fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            })
            .then(response => {
              if (response.ok) {
                status.textContent = `Location sent: ${data.latitude}, ${data.longitude}`;
              } else {
                status.textContent = 'Failed to send location.';
              }
            })
            .catch(() => {
              status.textContent = 'Error sending location.';
            });
          },
          error => {
            status.textContent = 'Unable to retrieve location.';
          }
        );
      } else {
        status.textContent = 'Geolocation is not supported by this browser.';
      }
    }
  </script>
</body>
</html>
